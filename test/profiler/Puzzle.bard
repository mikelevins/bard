;;;; ***********************************************************************)
;;;; FILE IDENTIFICATION
;;;;
;;;; Name:          Puzzle.bard
;;;; Project:       Nelson
;;;; Purpose:       Nelson's puzzle-description reader
;;;; 
;;;; Author:        mikel evins
;;;; Copyright:     2012 by mikel evins
;;;;
;;;; ***********************************************************************

(define *puzzles* {})

(define-function (add-puzzle! pname p)
  (set! *puzzles* (put *puzzles* pname p)))

(define-macro (puzzle title & args)
  `(add-puzzle! ,title (make <puzzle> title: ,title ,@args)))

(define-function (list-puzzles)
  (keys *puzzles*))

(define-function (list-titles)
  (map (method (k)
               (get (get *puzzles* k) title:))
       (keys *puzzles*)))

(define-function (title->puzzle-aux title keys)
  (if (empty? keys)
      nothing
      (let ((key (first keys))
            (puzzle (get *puzzles* key)))
        (if (= title (get puzzle title:))
            puzzle
            (title->puzzle-aux title (rest keys))))))

(define-function (title->puzzle title)
  (title->puzzle-aux title (keys *puzzles*)))

