<?xml version="1.0" encoding="utf-8"?>
<html
 ><body
  ><table cellspacing="0" cellpadding="0" border="0" style="font-size: 12px;"
   ><tr
    ><td
     >1: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;; ***********************************************************************</pre
     ></td
    ></tr
   ><tr
    ><td
     >2: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;; FILE IDENTIFICATION</pre
     ></td
    ></tr
   ><tr
    ><td
     >3: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;;</pre
     ></td
    ></tr
   ><tr
    ><td
     >4: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;; Name:          apply.scm</pre
     ></td
    ></tr
   ><tr
    ><td
     >5: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;; Project:       Bard</pre
     ></td
    ></tr
   ><tr
    ><td
     >6: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;; Purpose:       the apply function</pre
     ></td
    ></tr
   ><tr
    ><td
     >7: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;; Author:        mikel evins</pre
     ></td
    ></tr
   ><tr
    ><td
     >8: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;; Copyright:     2012 by mikel evins</pre
     ></td
    ></tr
   ><tr
    ><td
     >9: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;;</pre
     ></td
    ></tr
   ><tr
    ><td
     >10: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >;;;; ***********************************************************************</pre
     ></td
    ></tr
   ><tr
    ><td
     >11: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      ></pre
     ></td
    ></tr
   ><tr
    ><td
     >12: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >(define (%apply-keyed-collection op args)</pre
     ></td
    ></tr
   ><tr
    ><td
     >13: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >  (if (= 1 (%length args))</pre
     ></td
    ></tr
   ><tr
    ><td
     >14: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >      (cond</pre
     ></td
    ></tr
   ><tr
    ><td
     >15: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >       ((%null? op) %nil)</pre
     ></td
    ></tr
   ><tr
    ><td
     >16: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >       ((string? op)(string-ref op (%car args)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >17: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >       ((%list? op)(%list-ref op (%car args)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >18: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >       ((%frame? op)(%frame-get op (%car args)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >19: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >       (else (error (string-append "Not an applicable object: " (%as-string op)))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >20: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >      (error (string-append "Too many arguments: " (%as-string args)))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >21: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      ></pre
     ></td
    ></tr
   ><tr
    ><td
     >22: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >(define (%apply-primitive-method op args)</pre
     ></td
    ></tr
   ><tr
    ><td
     >23: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >  (let* ((required-count (%method-required-count op))</pre
     ></td
    ></tr
   ><tr
    ><td
     >24: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >         (argcount (%length args)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >25: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >    (if (&lt; argcount required-count)</pre
     ></td
    ></tr
   ><tr
    ><td
     >26: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >        (error (string-append "Not enough arguments: " (%as-string args)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >27: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >        (let ((rest? (%method-restarg op)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >28: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >          (if (and (not rest?)(&gt; argcount required-count))</pre
     ></td
    ></tr
   ><tr
    ><td
     >29: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >              (error (string-append "Too many arguments: " (%as-string args)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >30: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >              (let ((fn (%method-function op)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >31: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                (case argcount</pre
     ></td
    ></tr
   ><tr
    ><td
     >32: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                  ((0)(fn))</pre
     ></td
    ></tr
   ><tr
    ><td
     >33: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                  ((1)(let ((a (%list-ref args 0)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >34: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                        (fn a)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >35: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                  ((2)(let ((a (%list-ref args 0))</pre
     ></td
    ></tr
   ><tr
    ><td
     >36: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                            (b (%list-ref args 1)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >37: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                        (fn a b)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >38: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                  ((3)(let ((a (%list-ref args 0))</pre
     ></td
    ></tr
   ><tr
    ><td
     >39: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                            (b (%list-ref args 1))</pre
     ></td
    ></tr
   ><tr
    ><td
     >40: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                            (c (%list-ref args 2)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >41: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                        (fn a b c)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >42: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                  ((4)(let ((a (%list-ref args 0))</pre
     ></td
    ></tr
   ><tr
    ><td
     >43: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                            (b (%list-ref args 1))</pre
     ></td
    ></tr
   ><tr
    ><td
     >44: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                            (c (%list-ref args 2))</pre
     ></td
    ></tr
   ><tr
    ><td
     >45: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                            (d (%list-ref args 3)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >46: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                        (fn a b c d)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >47: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                  (else (let ((parms (%bard-list-&gt;cons args)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >48: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                          (apply fn parms))))))))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >49: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      ></pre
     ></td
    ></tr
   ><tr
    ><td
     >50: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >(define (%method-lexical-environment env params rest vals)</pre
     ></td
    ></tr
   ><tr
    ><td
     >51: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >  (let loop ((env env)</pre
     ></td
    ></tr
   ><tr
    ><td
     >52: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >             (formals params)</pre
     ></td
    ></tr
   ><tr
    ><td
     >53: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >             (args vals))</pre
     ></td
    ></tr
   ><tr
    ><td
     >54: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >    (if (%null? args)</pre
     ></td
    ></tr
   ><tr
    ><td
     >55: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >        ;; out of args</pre
     ></td
    ></tr
   ><tr
    ><td
     >56: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >        (if (%null? formals)</pre
     ></td
    ></tr
   ><tr
    ><td
     >57: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >            (if (%true? rest)</pre
     ></td
    ></tr
   ><tr
    ><td
     >58: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                (%add-binding env rest args)</pre
     ></td
    ></tr
   ><tr
    ><td
     >59: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                env)</pre
     ></td
    ></tr
   ><tr
    ><td
     >60: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >            (error (string-append "Not enough arguments: " (%as-string vals))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >61: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >        ;; more args to process</pre
     ></td
    ></tr
   ><tr
    ><td
     >62: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >        (if (%null? formals)</pre
     ></td
    ></tr
   ><tr
    ><td
     >63: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >            (if (%true? rest)</pre
     ></td
    ></tr
   ><tr
    ><td
     >64: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                (%add-binding env rest args)</pre
     ></td
    ></tr
   ><tr
    ><td
     >65: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                (error (string-append "Too many arguments: " (%as-string vals))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >66: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >            (loop (%add-binding env (%car formals)(%car args))</pre
     ></td
    ></tr
   ><tr
    ><td
     >67: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                  (%cdr formals)</pre
     ></td
    ></tr
   ><tr
    ><td
     >68: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >                  (%cdr args))))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >69: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      ></pre
     ></td
    ></tr
   ><tr
    ><td
     >70: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >(define (%apply-interpreted-method op params)</pre
     ></td
    ></tr
   ><tr
    ><td
     >71: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >  (let* ((required-count (%method-required-count op))</pre
     ></td
    ></tr
   ><tr
    ><td
     >72: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >         (argcount (%length params)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >73: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >    (if (&lt; argcount required-count)</pre
     ></td
    ></tr
   ><tr
    ><td
     >74: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >        (error (string-append "Not enough arguments: " (%as-string params)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >75: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >        (let ((rest (%method-restarg op))</pre
     ></td
    ></tr
   ><tr
    ><td
     >76: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >              (body (%method-body op))</pre
     ></td
    ></tr
   ><tr
    ><td
     >77: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >              (env (%method-environment op))</pre
     ></td
    ></tr
   ><tr
    ><td
     >78: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >              (formals (%method-formals op)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >79: </td
    ><td align="center"
     >7.69% </td
    ><td
     ><pre style="background-color:#cf7faf"
      >          (let* ((env (%method-lexical-environment env formals rest params)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >80: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >            (%eval body env))))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >81: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      ></pre
     ></td
    ></tr
   ><tr
    ><td
     >82: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >(define (%apply-function fn params)</pre
     ></td
    ></tr
   ><tr
    ><td
     >83: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >  (receive (best-method signature) (%function-best-method fn params)</pre
     ></td
    ></tr
   ><tr
    ><td
     >84: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >           (if best-method</pre
     ></td
    ></tr
   ><tr
    ><td
     >85: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >               (%apply best-method params)</pre
     ></td
    ></tr
   ><tr
    ><td
     >86: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >               (error (string-append "No applicable method for " (%as-string fn) " with arguments " (%as-string params))))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >87: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      ></pre
     ></td
    ></tr
   ><tr
    ><td
     >88: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >(define (%apply op args)</pre
     ></td
    ></tr
   ><tr
    ><td
     >89: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >  (cond</pre
     ></td
    ></tr
   ><tr
    ><td
     >90: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >   ((%keyed-collection? op)(%apply-keyed-collection op args))</pre
     ></td
    ></tr
   ><tr
    ><td
     >91: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >   ((%primitive-method? op)(%apply-primitive-method op args))</pre
     ></td
    ></tr
   ><tr
    ><td
     >92: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >   ((%interpreted-method? op)(%apply-interpreted-method op args))</pre
     ></td
    ></tr
   ><tr
    ><td
     >93: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >   ((%function? op)(%apply-function op args))</pre
     ></td
    ></tr
   ><tr
    ><td
     >94: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >   ((procedure? op)(apply op (%bard-list-&gt;cons args)))</pre
     ></td
    ></tr
   ><tr
    ><td
     >95: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >   (else (error (string-append "not an applicable object: " (object-&gt;string op) "; args: " (object-&gt;string args))))))</pre
     ></td
    ></tr
   ><tr
    ><td
     >96: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      ></pre
     ></td
    ></tr
   ><tr
    ><td
     >97: </td
    ><td align="center"
     ></td
    ><td
     ><pre style="background-color:#ffffff"
      >(define %funcall (lambda (fn . args)(%apply fn (%cons-&gt;bard-list args))))</pre
     ></td
    ></tr
   ></table
  ></body
 ></html
>#!void