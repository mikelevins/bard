<html ><body ><table cellspacing="0" cellpadding="0" border="0" style="font-size: 12px;" ><tr ><td >1: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; ***********************************************************************</pre></td></tr><tr ><td >2: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; FILE IDENTIFICATION</pre></td></tr><tr ><td >3: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;;</pre></td></tr><tr ><td >4: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Name:          adjustable-vector.scm</pre></td></tr><tr ><td >5: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Project:       Bard</pre></td></tr><tr ><td >6: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Purpose:       vectors that can be resized</pre></td></tr><tr ><td >7: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Author:        mikel evins</pre></td></tr><tr ><td >8: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Copyright:     2012 by mikel evins</pre></td></tr><tr ><td >9: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;;</pre></td></tr><tr ><td >10: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; ***********************************************************************</pre></td></tr><tr ><td >11: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >12: </td><td align="center" >2.94% </td><td ><pre style="background-color:#bf7fbf" >(define-type adjustable-vector</pre></td></tr><tr ><td >13: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  id: 450A16E5-B4BF-4C81-A9A7-E1FACE726029</pre></td></tr><tr ><td >14: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  constructor: %private-make-adjustable-vector</pre></td></tr><tr ><td >15: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (increment adjustable-vector-increment set-adjustable-vector-increment!)</pre></td></tr><tr ><td >16: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (default-element adjustable-vector-default-element set-adjustable-vector-default-element!)</pre></td></tr><tr ><td >17: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (slots adjustable-vector-slots set-adjustable-vector-slots!)</pre></td></tr><tr ><td >18: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (fill-pointer adjustable-vector-fill-pointer set-adjustable-vector-fill-pointer!))</pre></td></tr><tr ><td >19: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >20: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (make-adjustable-vector initial-length #!key (increment 8)(default-element #f))</pre></td></tr><tr ><td >21: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let* ((factor (+ 1 (truncate (/ initial-length increment))))</pre></td></tr><tr ><td >22: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >         (len (* factor increment))</pre></td></tr><tr ><td >23: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >         (vec (make-vector len #f)))</pre></td></tr><tr ><td >24: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (let loop ((i 0))</pre></td></tr><tr ><td >25: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (if (&lt; i len)</pre></td></tr><tr ><td >26: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (begin</pre></td></tr><tr ><td >27: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (vector-set! vec i default-element)</pre></td></tr><tr ><td >28: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (loop (+ 1 i)))))</pre></td></tr><tr ><td >29: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (%private-make-adjustable-vector increment default-element vec 0)))</pre></td></tr><tr ><td >30: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >31: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (expand-adjustable-vector! av)</pre></td></tr><tr ><td >32: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let ((old-cap (adjustable-vector-capacity av))</pre></td></tr><tr ><td >33: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (len (adjustable-vector-length av))</pre></td></tr><tr ><td >34: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (increment (adjustable-vector-increment av))</pre></td></tr><tr ><td >35: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (factor (+ 1 (truncate (/ len increment))))</pre></td></tr><tr ><td >36: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (elt (adjustable-vector-default-element av))</pre></td></tr><tr ><td >37: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (new-cap (* factor increment))</pre></td></tr><tr ><td >38: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (old-slots (adjustable-vector-slots av))</pre></td></tr><tr ><td >39: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (new-slots (make-vector new-cap elt)))</pre></td></tr><tr ><td >40: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (subvector-move! old-slots 0 len new-slots 0)</pre></td></tr><tr ><td >41: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (set-adjustable-vector-slots! av new-slots)</pre></td></tr><tr ><td >42: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    av))</pre></td></tr><tr ><td >43: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >44: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (adjustable-vector-capacity av)</pre></td></tr><tr ><td >45: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (vector-length (adjustable-vector-slots av)))</pre></td></tr><tr ><td >46: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >47: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define adjustable-vector-length adjustable-vector-fill-pointer)</pre></td></tr><tr ><td >48: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >49: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (adjustable-vector-ref av i)</pre></td></tr><tr ><td >50: </td><td align="center" >2.21% </td><td ><pre style="background-color:#b77fc7" >  (assert (&lt; i (adjustable-vector-fill-pointer av)) (str "Index " i " is out of range"))</pre></td></tr><tr ><td >51: </td><td align="center" >1.47% </td><td ><pre style="background-color:#a77fd7" >  (vector-ref (adjustable-vector-slots av) i))</pre></td></tr><tr ><td >52: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >53: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (adjustable-vector-set! av i v)</pre></td></tr><tr ><td >54: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (assert (&lt; i (adjustable-vector-fill-pointer av)) (str "Index " i " is out of range"))</pre></td></tr><tr ><td >55: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (vector-set! (adjustable-vector-slots av) i v))</pre></td></tr><tr ><td >56: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >57: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (adjustable-vector-push! av v)</pre></td></tr><tr ><td >58: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let ((cap (adjustable-vector-capacity av))</pre></td></tr><tr ><td >59: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (len (adjustable-vector-length av)))</pre></td></tr><tr ><td >60: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (&gt;= len cap)</pre></td></tr><tr ><td >61: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (expand-adjustable-vector! av))</pre></td></tr><tr ><td >62: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (vector-set! (adjustable-vector-slots av) len v)</pre></td></tr><tr ><td >63: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (set-adjustable-vector-fill-pointer! av (+ len 1))</pre></td></tr><tr ><td >64: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    av))</pre></td></tr><tr ><td >65: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >66: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (adjustable-vector-position test av)</pre></td></tr><tr ><td >67: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (vector-position test (adjustable-vector-slots av) end: (adjustable-vector-length av)))</pre></td></tr></table></body></html>