<html ><body ><table cellspacing="0" cellpadding="0" border="0" style="font-size: 12px;" ><tr ><td >1: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; ***********************************************************************</pre></td></tr><tr ><td >2: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; FILE IDENTIFICATION</pre></td></tr><tr ><td >3: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;;</pre></td></tr><tr ><td >4: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Name:          env.scm</pre></td></tr><tr ><td >5: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Project:       Bard</pre></td></tr><tr ><td >6: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Purpose:       variable-binding environments</pre></td></tr><tr ><td >7: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Author:        mikel evins</pre></td></tr><tr ><td >8: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Copyright:     2012 by mikel evins</pre></td></tr><tr ><td >9: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;;</pre></td></tr><tr ><td >10: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; ***********************************************************************</pre></td></tr><tr ><td >11: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >12: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >13: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; global environment</pre></td></tr><tr ><td >14: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >15: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >16: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%global-variables)</pre></td></tr><tr ><td >17: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (make-table test: eq?))</pre></td></tr><tr ><td >18: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >19: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define $bard-global-variables #f)</pre></td></tr><tr ><td >20: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >21: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%defglobal var val)</pre></td></tr><tr ><td >22: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (table-set! $bard-global-variables var val)</pre></td></tr><tr ><td >23: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  var)</pre></td></tr><tr ><td >24: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >25: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%global-value var)</pre></td></tr><tr ><td >26: </td><td align="center" >1.16% </td><td ><pre style="background-color:#a77fd7" >  (table-ref $bard-global-variables var (%undefined)))</pre></td></tr><tr ><td >27: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >28: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >29: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; lexical environments</pre></td></tr><tr ><td >30: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >31: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >32: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%null-environment) '())</pre></td></tr><tr ><td >33: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >34: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%add-binding env var val)</pre></td></tr><tr ><td >35: </td><td align="center" >3.49% </td><td ><pre style="background-color:#d77fa7" >  (cons (cons var val) env))</pre></td></tr><tr ><td >36: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >37: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%add-let-bindings env bindings)</pre></td></tr><tr ><td >38: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (%null? bindings)</pre></td></tr><tr ><td >39: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      env</pre></td></tr><tr ><td >40: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (let ((binding (%car bindings)))</pre></td></tr><tr ><td >41: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%add-let-bindings (%add-binding env</pre></td></tr><tr ><td >42: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                                         (%car binding)</pre></td></tr><tr ><td >43: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                                         (%eval (%cadr binding)</pre></td></tr><tr ><td >44: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                                                env))</pre></td></tr><tr ><td >45: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                           (%cdr bindings)))))</pre></td></tr><tr ><td >46: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >47: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%extend-environment env plist)</pre></td></tr><tr ><td >48: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (null? plist)</pre></td></tr><tr ><td >49: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      env</pre></td></tr><tr ><td >50: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (if (null? (cdr plist))</pre></td></tr><tr ><td >51: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (error "Odd number of arguments to extend-environment" plist)</pre></td></tr><tr ><td >52: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (let* ((var (car plist))</pre></td></tr><tr ><td >53: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                 (val (cadr plist)))</pre></td></tr><tr ><td >54: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (%extend-environment (%add-binding env var val) (cddr plist))))))</pre></td></tr><tr ><td >55: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >56: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%merge-environments env1 env2)</pre></td></tr><tr ><td >57: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (append env2 env1))</pre></td></tr><tr ><td >58: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >59: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%copy-environment env)</pre></td></tr><tr ><td >60: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (%null? env)</pre></td></tr><tr ><td >61: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      '()</pre></td></tr><tr ><td >62: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (let ((binding (%car env)))</pre></td></tr><tr ><td >63: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%cons (%cons (%car binding)</pre></td></tr><tr ><td >64: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                      (%cdr binding))</pre></td></tr><tr ><td >65: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (%copy-environment (%cdr env))))))</pre></td></tr><tr ><td >66: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >67: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%lookup-variable-value env var)</pre></td></tr><tr ><td >68: </td><td align="center" >2.33% </td><td ><pre style="background-color:#bf7fbf" >  (let ((binding (assq var env)))</pre></td></tr><tr ><td >69: </td><td align="center" >1.16% </td><td ><pre style="background-color:#a77fd7" >    (if binding (cdr binding) (%undefined))))</pre></td></tr><tr ><td >70: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >71: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%set-variable! var val env)</pre></td></tr><tr ><td >72: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let ((binding (assq var env)))</pre></td></tr><tr ><td >73: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if binding</pre></td></tr><tr ><td >74: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (begin</pre></td></tr><tr ><td >75: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (set-cdr! binding val)</pre></td></tr><tr ><td >76: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          val)</pre></td></tr><tr ><td >77: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (let ((global-val (%global-value var)))</pre></td></tr><tr ><td >78: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (if (%defined? global-val)</pre></td></tr><tr ><td >79: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (begin</pre></td></tr><tr ><td >80: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (%defglobal var val)</pre></td></tr><tr ><td >81: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                val)</pre></td></tr><tr ><td >82: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (error (string-append "Undefined variable: " (symbol-&gt;string var))))))))</pre></td></tr><tr ><td >83: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr></table></body></html>