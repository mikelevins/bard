<html ><body ><table cellspacing="0" cellpadding="0" border="0" style="font-size: 12px;" ><tr ><td >1: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; ***********************************************************************</pre></td></tr><tr ><td >2: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; FILE IDENTIFICATION</pre></td></tr><tr ><td >3: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;;</pre></td></tr><tr ><td >4: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Name:          values.scm</pre></td></tr><tr ><td >5: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Project:       Bard</pre></td></tr><tr ><td >6: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Purpose:       representation of basic Bard values</pre></td></tr><tr ><td >7: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Author:        mikel evins</pre></td></tr><tr ><td >8: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; Copyright:     2012 by mikel evins</pre></td></tr><tr ><td >9: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;;</pre></td></tr><tr ><td >10: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;; ***********************************************************************</pre></td></tr><tr ><td >11: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >12: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >13: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; undefined</pre></td></tr><tr ><td >14: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >15: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >16: </td><td align="center" >1.16% </td><td ><pre style="background-color:#a77fd7" >(define (%undefined) #!unbound)</pre></td></tr><tr ><td >17: </td><td align="center" >2.33% </td><td ><pre style="background-color:#bf7fbf" >(define (%undefined? x) (or (eqv? x #!unbound)(eqv? x #!void)))</pre></td></tr><tr ><td >18: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%defined? x)(not (%undefined? x)))</pre></td></tr><tr ><td >19: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >20: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >21: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; primitive-procedure</pre></td></tr><tr ><td >22: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >23: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >24: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %primitive-procedure? procedure?)</pre></td></tr><tr ><td >25: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >26: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >27: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; nothing</pre></td></tr><tr ><td >28: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >29: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >30: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%nothing) '())</pre></td></tr><tr ><td >31: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %nothing? null?)</pre></td></tr><tr ><td >32: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%something? x)(not (%nothing? x)))</pre></td></tr><tr ><td >33: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >34: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >35: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; characters</pre></td></tr><tr ><td >36: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >37: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >38: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %character? char?)</pre></td></tr><tr ><td >39: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >40: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >41: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; boolean</pre></td></tr><tr ><td >42: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >43: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >44: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%false) #f)</pre></td></tr><tr ><td >45: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >46: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%false? x) </pre></td></tr><tr ><td >47: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (or (eqv? x (%false))</pre></td></tr><tr ><td >48: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (%nothing? x)))</pre></td></tr><tr ><td >49: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >50: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%true) #t)</pre></td></tr><tr ><td >51: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%true? x) </pre></td></tr><tr ><td >52: </td><td align="center" >1.16% </td><td ><pre style="background-color:#a77fd7" >  (and (not (%false? x))</pre></td></tr><tr ><td >53: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >       (not (%undefined? x))))</pre></td></tr><tr ><td >54: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >55: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%boolean? x)</pre></td></tr><tr ><td >56: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (or (eqv? x (%false))</pre></td></tr><tr ><td >57: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (eqv? x (%true))))</pre></td></tr><tr ><td >58: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >59: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >60: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; numbers</pre></td></tr><tr ><td >61: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >62: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >63: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %fixnum? ##fixnum?)</pre></td></tr><tr ><td >64: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %fixnum? ##bignum?)</pre></td></tr><tr ><td >65: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >66: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%integer? x)</pre></td></tr><tr ><td >67: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (or (##fixnum? x)</pre></td></tr><tr ><td >68: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (##bignum? x)))</pre></td></tr><tr ><td >69: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >70: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%float? x)</pre></td></tr><tr ><td >71: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (##flonum? x))</pre></td></tr><tr ><td >72: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >73: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%ratio? x)</pre></td></tr><tr ><td >74: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (##ratnum? x))</pre></td></tr><tr ><td >75: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >76: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%number? x) </pre></td></tr><tr ><td >77: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (or (%integer? x)</pre></td></tr><tr ><td >78: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (%float? x)</pre></td></tr><tr ><td >79: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (%ratio? x)))</pre></td></tr><tr ><td >80: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >81: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >82: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; names</pre></td></tr><tr ><td >83: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >84: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >85: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %symbol? symbol?)</pre></td></tr><tr ><td >86: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %keyword? keyword?)</pre></td></tr><tr ><td >87: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%name? x) </pre></td></tr><tr ><td >88: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (or (%symbol? x)</pre></td></tr><tr ><td >89: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (%keyword? x)))</pre></td></tr><tr ><td >90: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >91: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >92: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; text</pre></td></tr><tr ><td >93: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ----------------------------------------------------------------------</pre></td></tr><tr ><td >94: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >95: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %string? string?)</pre></td></tr><tr ><td >96: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %text? string?)</pre></td></tr><tr ><td >97: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >98: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >99: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; list</pre></td></tr><tr ><td >100: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >101: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >102: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %nil '())</pre></td></tr><tr ><td >103: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %null? null?)</pre></td></tr><tr ><td >104: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %list? list?)</pre></td></tr><tr ><td >105: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %list list)</pre></td></tr><tr ><td >106: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %cons cons)</pre></td></tr><tr ><td >107: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %car car)</pre></td></tr><tr ><td >108: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %cdr cdr)</pre></td></tr><tr ><td >109: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %cadr cadr)</pre></td></tr><tr ><td >110: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %cddr cddr)</pre></td></tr><tr ><td >111: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %first car)</pre></td></tr><tr ><td >112: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%last ls) (%list-ref ls (- (%length ls) 1)))</pre></td></tr><tr ><td >113: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %length length)</pre></td></tr><tr ><td >114: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %append append)</pre></td></tr><tr ><td >115: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %reverse reverse)</pre></td></tr><tr ><td >116: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >117: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%some? test ls)</pre></td></tr><tr ><td >118: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let loop ((items ls))</pre></td></tr><tr ><td >119: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (%null? items)</pre></td></tr><tr ><td >120: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%nothing)</pre></td></tr><tr ><td >121: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (if (test (%car items))</pre></td></tr><tr ><td >122: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (%car items)</pre></td></tr><tr ><td >123: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (loop (%cdr items))))))</pre></td></tr><tr ><td >124: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >125: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%every? test ls #!optional (ls2 #f))</pre></td></tr><tr ><td >126: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if ls2</pre></td></tr><tr ><td >127: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (let loop ((items1 ls)</pre></td></tr><tr ><td >128: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                 (items2 ls2))</pre></td></tr><tr ><td >129: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (if (or (%null? items1)</pre></td></tr><tr ><td >130: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (%null? items2))</pre></td></tr><tr ><td >131: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (%true)</pre></td></tr><tr ><td >132: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (if (test (%car items1)(%car items2))</pre></td></tr><tr ><td >133: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (loop (%cdr items1)(%cdr items2))</pre></td></tr><tr ><td >134: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (%false))))</pre></td></tr><tr ><td >135: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (let loop ((items ls))</pre></td></tr><tr ><td >136: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (if (%null? items)</pre></td></tr><tr ><td >137: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (%true)</pre></td></tr><tr ><td >138: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (if (test (%car items))</pre></td></tr><tr ><td >139: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (loop (%cdr items))</pre></td></tr><tr ><td >140: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (%false))))))</pre></td></tr><tr ><td >141: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >142: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%position test ls)</pre></td></tr><tr ><td >143: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let ((len (%length ls)))</pre></td></tr><tr ><td >144: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (let loop ((items ls)</pre></td></tr><tr ><td >145: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >               (i 0))</pre></td></tr><tr ><td >146: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (if (&gt;= i len)</pre></td></tr><tr ><td >147: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (%false)</pre></td></tr><tr ><td >148: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (if (test (%car items))</pre></td></tr><tr ><td >149: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              i</pre></td></tr><tr ><td >150: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (loop (%cdr items)(+ 1 i)))))))</pre></td></tr><tr ><td >151: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >152: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%drop n ls)(list-tail ls n))</pre></td></tr><tr ><td >153: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >154: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%take n ls)</pre></td></tr><tr ><td >155: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let ((len (%length ls)))</pre></td></tr><tr ><td >156: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (let loop ((items ls)</pre></td></tr><tr ><td >157: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >               (i 0)</pre></td></tr><tr ><td >158: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >               (result %nil))</pre></td></tr><tr ><td >159: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (if (&gt;= i n)</pre></td></tr><tr ><td >160: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          result</pre></td></tr><tr ><td >161: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (if (%null? items)</pre></td></tr><tr ><td >162: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (error (string-append "Can't take " (%as-string n) " items from " (%as-string ls)))</pre></td></tr><tr ><td >163: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (loop (%cdr items)(+ i 1)(%append result (%list (%car items)))))))))</pre></td></tr><tr ><td >164: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >165: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >166: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%remove x ls #!optional (test equal?))</pre></td></tr><tr ><td >167: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let loop ((items ls)</pre></td></tr><tr ><td >168: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (result %nil))</pre></td></tr><tr ><td >169: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (%null? items)</pre></td></tr><tr ><td >170: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        result</pre></td></tr><tr ><td >171: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (let ((item (%car items)))</pre></td></tr><tr ><td >172: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (if (test x item)</pre></td></tr><tr ><td >173: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (loop (%cdr items) result)</pre></td></tr><tr ><td >174: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (loop (%cdr items)(%append result (%list item))))))))</pre></td></tr><tr ><td >175: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >176: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %list-ref list-ref)</pre></td></tr><tr ><td >177: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %map map)</pre></td></tr><tr ><td >178: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define %for-each for-each)</pre></td></tr><tr ><td >179: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >180: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%bard-list-&gt;cons x) x)</pre></td></tr><tr ><td >181: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%cons-&gt;bard-list x) x)</pre></td></tr><tr ><td >182: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >183: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >184: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; table</pre></td></tr><tr ><td >185: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >186: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >187: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define $empty-slots '())</pre></td></tr><tr ><td >188: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >189: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define-type %table</pre></td></tr><tr ><td >190: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  id: 87DD4EB3-09F7-41A4-BEED-0B74FF5C92CE</pre></td></tr><tr ><td >191: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  extender: %define-table-type</pre></td></tr><tr ><td >192: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  constructor: %private-make-table</pre></td></tr><tr ><td >193: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (slots %table-slots))</pre></td></tr><tr ><td >194: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >195: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define $empty-table (%private-make-table $empty-slots))</pre></td></tr><tr ><td >196: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >197: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define &lt;table&gt; (%define-standard-type '&lt;table&gt; (##structure-type (%private-make-table $empty-slots))))</pre></td></tr><tr ><td >198: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >199: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%table-slot? x)</pre></td></tr><tr ><td >200: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (and (%list? x)</pre></td></tr><tr ><td >201: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >       (not (%null? x))</pre></td></tr><tr ><td >202: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >       (not (%null? (%cdr x)))</pre></td></tr><tr ><td >203: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >       (%null? (%cddr x))))</pre></td></tr><tr ><td >204: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >205: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%plist-&gt;slots plist)</pre></td></tr><tr ><td >206: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let loop ((kvs plist))</pre></td></tr><tr ><td >207: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (null? kvs)</pre></td></tr><tr ><td >208: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        '()</pre></td></tr><tr ><td >209: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (if (null? (cdr kvs))</pre></td></tr><tr ><td >210: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (error (string-append "Malformed plist: " (object-&gt;string plist)))</pre></td></tr><tr ><td >211: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (cons (list (car kvs)</pre></td></tr><tr ><td >212: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                        (cadr kvs))</pre></td></tr><tr ><td >213: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                  (loop (cddr kvs)))))))</pre></td></tr><tr ><td >214: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >215: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%make-table kv-plist)</pre></td></tr><tr ><td >216: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let* ((slots (%plist-&gt;slots kv-plist)))</pre></td></tr><tr ><td >217: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (%private-make-table slots)))</pre></td></tr><tr ><td >218: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >219: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%maybe-slot-list-&gt;table slist)</pre></td></tr><tr ><td >220: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let loop ((slist slist)</pre></td></tr><tr ><td >221: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (slots '())</pre></td></tr><tr ><td >222: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (keys '()))</pre></td></tr><tr ><td >223: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (null? slist)</pre></td></tr><tr ><td >224: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%private-make-table (reverse slots))</pre></td></tr><tr ><td >225: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (let ((slot (car slist)))</pre></td></tr><tr ><td >226: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (if (%table-slot? slot)</pre></td></tr><tr ><td >227: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (let ((key (car slot)))</pre></td></tr><tr ><td >228: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (if (member key keys)</pre></td></tr><tr ><td >229: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                    slist</pre></td></tr><tr ><td >230: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                    (loop (cdr slist)</pre></td></tr><tr ><td >231: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                          (cons slot slots)</pre></td></tr><tr ><td >232: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                          (cons key keys))))</pre></td></tr><tr ><td >233: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              slist)))))</pre></td></tr><tr ><td >234: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >235: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%table . kv-plist)(%make-table kv-plist))</pre></td></tr><tr ><td >236: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >237: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%table-get fr key #!optional (default (%nothing)))</pre></td></tr><tr ><td >238: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let ((slot (assoc key (%table-slots fr))))</pre></td></tr><tr ><td >239: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if slot (cadr slot) default)))</pre></td></tr><tr ><td >240: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >241: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%table-put fr key value)</pre></td></tr><tr ><td >242: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let* ((new-slots (append</pre></td></tr><tr ><td >243: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                     (remove-if (lambda (slot)(equal? key (car slot)))</pre></td></tr><tr ><td >244: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                                (%table-slots fr))</pre></td></tr><tr ><td >245: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                     (list (list key value)))))</pre></td></tr><tr ><td >246: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (%private-make-table new-slots)))</pre></td></tr><tr ><td >247: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >248: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%list-get ls key #!optional (default (%nothing)))</pre></td></tr><tr ><td >249: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (and (integer? key)</pre></td></tr><tr ><td >250: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >           (&lt; -1 key (length ls)))</pre></td></tr><tr ><td >251: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (list-ref ls key)</pre></td></tr><tr ><td >252: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      default))</pre></td></tr><tr ><td >253: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >254: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%list-put ls key value)</pre></td></tr><tr ><td >255: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (and (integer? key)</pre></td></tr><tr ><td >256: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >           (&lt; -1 key (length ls)))</pre></td></tr><tr ><td >257: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (append (take key ls) (list value) (drop (+ 1 key) ls))</pre></td></tr><tr ><td >258: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (let* ((pairs (map list (iota (length ls)) ls))</pre></td></tr><tr ><td >259: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (fr (%private-make-table pairs)))</pre></td></tr><tr ><td >260: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%table-put fr key value))))</pre></td></tr><tr ><td >261: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >262: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%string-get str key #!optional (default (%nothing)))</pre></td></tr><tr ><td >263: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (and (integer? key)</pre></td></tr><tr ><td >264: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >           (&lt; -1 key (string-length str)))</pre></td></tr><tr ><td >265: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (string-ref str key)</pre></td></tr><tr ><td >266: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      default))</pre></td></tr><tr ><td >267: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >268: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%string-put str k v)</pre></td></tr><tr ><td >269: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (and (integer? k)</pre></td></tr><tr ><td >270: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >           (&lt; -1 k (string-length str))</pre></td></tr><tr ><td >271: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >           (char? v))</pre></td></tr><tr ><td >272: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (string-append (substring str 0 k) (string v) (substring str (+ k 1)(string-length str)))</pre></td></tr><tr ><td >273: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (let* ((chars (string-&gt;list str))</pre></td></tr><tr ><td >274: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (pairs (map list (iota (string-length str)) chars))</pre></td></tr><tr ><td >275: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (fr (%private-make-table pairs)))</pre></td></tr><tr ><td >276: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%table-put fr k v))))</pre></td></tr><tr ><td >277: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >278: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%table-keys fr)(map car (%table-slots fr)))</pre></td></tr><tr ><td >279: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%table-vals fr)(map cadr (%table-slots fr)))</pre></td></tr><tr ><td >280: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >281: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%get obj key)</pre></td></tr><tr ><td >282: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (cond</pre></td></tr><tr ><td >283: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((string? obj) (%string-get obj key))</pre></td></tr><tr ><td >284: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((pair? obj) (%list-get obj key))</pre></td></tr><tr ><td >285: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((%table? obj) (%table-get obj key))))</pre></td></tr><tr ><td >286: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >287: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%parse-slot-path path)</pre></td></tr><tr ><td >288: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (cond </pre></td></tr><tr ><td >289: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((string? path)</pre></td></tr><tr ><td >290: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (string-split-on #\. path))</pre></td></tr><tr ><td >291: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((list? path)</pre></td></tr><tr ><td >292: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (every? string? path)</pre></td></tr><tr ><td >293: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        path</pre></td></tr><tr ><td >294: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (error (string-append "Invalid slot path: "</pre></td></tr><tr ><td >295: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                              (object-&gt;string path)))))</pre></td></tr><tr ><td >296: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   (else (error (string-append "Invalid slot path: "</pre></td></tr><tr ><td >297: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                               (object-&gt;string path))))))</pre></td></tr><tr ><td >298: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >299: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%get-any-of obj keys)</pre></td></tr><tr ><td >300: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let loop ((keys keys))</pre></td></tr><tr ><td >301: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (null? keys)</pre></td></tr><tr ><td >302: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%nothing)</pre></td></tr><tr ><td >303: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (let ((val (%get obj (car keys))))</pre></td></tr><tr ><td >304: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (if (%something? val)</pre></td></tr><tr ><td >305: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              val</pre></td></tr><tr ><td >306: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (loop (cdr keys)))))))</pre></td></tr><tr ><td >307: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >308: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%as-keyword-key key)</pre></td></tr><tr ><td >309: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (cond</pre></td></tr><tr ><td >310: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((keyword? key) key)</pre></td></tr><tr ><td >311: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((symbol? key) (string-&gt;keyword (symbol-&gt;string key)))</pre></td></tr><tr ><td >312: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((string? key)(string-&gt;keyword key))</pre></td></tr><tr ><td >313: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   (else (error (string-append "Invalid key: "</pre></td></tr><tr ><td >314: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                               (object-&gt;string key))))))</pre></td></tr><tr ><td >315: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >316: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%as-symbol-key key)</pre></td></tr><tr ><td >317: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (cond</pre></td></tr><tr ><td >318: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((keyword? key)(string-&gt;symbol (keyword-&gt;string key)))</pre></td></tr><tr ><td >319: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((symbol? key) key)</pre></td></tr><tr ><td >320: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((string? key)(string-&gt;symbol key))</pre></td></tr><tr ><td >321: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   (else (error (string-append "Invalid key: "</pre></td></tr><tr ><td >322: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                               (object-&gt;string key))))))</pre></td></tr><tr ><td >323: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >324: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%as-string-key key)</pre></td></tr><tr ><td >325: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (cond</pre></td></tr><tr ><td >326: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((keyword? key)(keyword-&gt;string key))</pre></td></tr><tr ><td >327: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((symbol? key)(symbol-&gt;string key))</pre></td></tr><tr ><td >328: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((string? key) key)</pre></td></tr><tr ><td >329: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   (else (error (string-append "Invalid key: "</pre></td></tr><tr ><td >330: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                               (object-&gt;string key))))))</pre></td></tr><tr ><td >331: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >332: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%get-path obj path)</pre></td></tr><tr ><td >333: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (null? path)</pre></td></tr><tr ><td >334: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (%nothing)</pre></td></tr><tr ><td >335: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (let* ((path (%parse-slot-path path))</pre></td></tr><tr ><td >336: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (key (car path))</pre></td></tr><tr ><td >337: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (keys (list (%as-keyword-key key)</pre></td></tr><tr ><td >338: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                         (%as-symbol-key key)</pre></td></tr><tr ><td >339: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                         (%as-string-key key)))</pre></td></tr><tr ><td >340: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (new-obj (%get-any-of obj keys)))</pre></td></tr><tr ><td >341: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (if new-obj</pre></td></tr><tr ><td >342: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (if (null? (cdr path))</pre></td></tr><tr ><td >343: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                new-obj</pre></td></tr><tr ><td >344: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (%get-path new-obj (cdr path)))</pre></td></tr><tr ><td >345: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >            (%nothing)))))</pre></td></tr><tr ><td >346: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >347: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%get-keyword-symbol-or-string-key obj key)</pre></td></tr><tr ><td >348: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (or (null? key)(null? obj))</pre></td></tr><tr ><td >349: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (%nothing)</pre></td></tr><tr ><td >350: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (let ((keys (list (%as-keyword-key key)</pre></td></tr><tr ><td >351: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                        (%as-symbol-key key)</pre></td></tr><tr ><td >352: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                        (%as-string-key key))))</pre></td></tr><tr ><td >353: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%get-any-of obj keys))))</pre></td></tr><tr ><td >354: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >355: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%put obj key val)</pre></td></tr><tr ><td >356: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (cond</pre></td></tr><tr ><td >357: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((string? obj) (%string-put obj key val))</pre></td></tr><tr ><td >358: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((pair? obj) (%list-put obj key val))</pre></td></tr><tr ><td >359: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >   ((%table? obj) (%table-put obj key val))))</pre></td></tr><tr ><td >360: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >361: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >362: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; schemas (user-defined types)</pre></td></tr><tr ><td >363: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; ---------------------------------------------------------------------</pre></td></tr><tr ><td >364: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;</pre></td></tr><tr ><td >365: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; (define-schema &lt;foo&gt; (&lt;bar&gt; &lt;baz&gt;)</pre></td></tr><tr ><td >366: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;   grault</pre></td></tr><tr ><td >367: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;   (quux :default 0 :mutable true)</pre></td></tr><tr ><td >368: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;;   (wibble :initializer (method (instance supplied-value) ...)))</pre></td></tr><tr ><td >369: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; (define x (make &lt;foo&gt; grault: 1))</pre></td></tr><tr ><td >370: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; (grault x) =&gt; 1</pre></td></tr><tr ><td >371: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; (quux x) =&gt; 0</pre></td></tr><tr ><td >372: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; (set! (quux x) 101)</pre></td></tr><tr ><td >373: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >;;; (quux x) =&gt; 101</pre></td></tr><tr ><td >374: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >375: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(%define-table-type %schema</pre></td></tr><tr ><td >376: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" > constructor: %private-make-schema</pre></td></tr><tr ><td >377: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" > name</pre></td></tr><tr ><td >378: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" > includes</pre></td></tr><tr ><td >379: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" > slot-names</pre></td></tr><tr ><td >380: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" > tag)</pre></td></tr><tr ><td >381: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >382: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define &lt;schema&gt; </pre></td></tr><tr ><td >383: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (%define-standard-type '&lt;schema&gt; (##structure-type (%private-make-schema $empty-slots #f '() '() -1))))</pre></td></tr><tr ><td >384: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >385: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%all-slots schema) (%table-slots schema))</pre></td></tr><tr ><td >386: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >387: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%spec-&gt;slot spec)</pre></td></tr><tr ><td >388: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let* ((sname (car spec))</pre></td></tr><tr ><td >389: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >         (attrs (cdr spec))</pre></td></tr><tr ><td >390: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >         (default (getf default: attrs (%nothing))))</pre></td></tr><tr ><td >391: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (cons sname default)))</pre></td></tr><tr ><td >392: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >393: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%ensure-no-conflicting-slots slots)</pre></td></tr><tr ><td >394: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let loop ((ss slots)</pre></td></tr><tr ><td >395: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (keys '()))</pre></td></tr><tr ><td >396: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (null? ss)</pre></td></tr><tr ><td >397: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        slots</pre></td></tr><tr ><td >398: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (let ((slot (car ss)))</pre></td></tr><tr ><td >399: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (if (member (car slot) keys)</pre></td></tr><tr ><td >400: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (error (string-append "Duplicate key in schema slot-descriptions: " (car slot)))</pre></td></tr><tr ><td >401: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (loop (cdr ss) </pre></td></tr><tr ><td >402: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                    (cons (car slot)</pre></td></tr><tr ><td >403: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                          keys)))))))</pre></td></tr><tr ><td >404: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >405: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%assemble-schema-slots includes slot-specs)</pre></td></tr><tr ><td >406: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let* ((included-slots (apply append (map %all-slots includes)))</pre></td></tr><tr ><td >407: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >         (new-slots (map %spec-&gt;slot slot-specs)))</pre></td></tr><tr ><td >408: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (%ensure-no-conflicting-slots (append included-slots new-slots))))</pre></td></tr><tr ><td >409: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >410: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%make-schema name includes slot-specs)</pre></td></tr><tr ><td >411: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let* ((slots (%assemble-schema-slots includes slot-specs))</pre></td></tr><tr ><td >412: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >         (slot-names (map car slots))</pre></td></tr><tr ><td >413: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >         (tag (%next-available-type-tag))</pre></td></tr><tr ><td >414: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >         (sc (%private-make-schema slots name includes slot-names tag)))</pre></td></tr><tr ><td >415: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (%assert-type! tag sc)</pre></td></tr><tr ><td >416: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    sc))</pre></td></tr><tr ><td >417: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >418: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >419: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(%define-table-type %schema-instance</pre></td></tr><tr ><td >420: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" > constructor: %private-make-schema-instance</pre></td></tr><tr ><td >421: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" > schema)</pre></td></tr><tr ><td >422: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >423: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%validate-initargs schema initargs)</pre></td></tr><tr ><td >424: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let ((specs (%table-slots schema)))</pre></td></tr><tr ><td >425: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (let loop ((inits initargs))</pre></td></tr><tr ><td >426: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (if (null? inits)</pre></td></tr><tr ><td >427: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          #t</pre></td></tr><tr ><td >428: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (if (null? (cdr inits))</pre></td></tr><tr ><td >429: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (error (string-append "Malformed schema init list:"</pre></td></tr><tr ><td >430: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                                    (object-&gt;string initargs)))</pre></td></tr><tr ><td >431: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >              (if (assoc (car inits) specs)</pre></td></tr><tr ><td >432: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                  (loop (cddr inits))</pre></td></tr><tr ><td >433: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                  (error (string-append "Unrecognized slot name in initializer:"</pre></td></tr><tr ><td >434: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                                        (object-&gt;string (car inits))))))))))</pre></td></tr><tr ><td >435: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >436: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%make schema . initargs)</pre></td></tr><tr ><td >437: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (%validate-initargs schema initargs)</pre></td></tr><tr ><td >438: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (let loop ((specs (%table-slots schema))</pre></td></tr><tr ><td >439: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >             (slots '()))</pre></td></tr><tr ><td >440: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >    (if (null? specs)</pre></td></tr><tr ><td >441: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (%private-make-schema-instance (reverse slots) schema)</pre></td></tr><tr ><td >442: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >        (let* ((spec (car specs))</pre></td></tr><tr ><td >443: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >               (sname (car spec))</pre></td></tr><tr ><td >444: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >               (sdefault (cdr spec))</pre></td></tr><tr ><td >445: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >               (init (member sname initargs))</pre></td></tr><tr ><td >446: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >               (sval (if init</pre></td></tr><tr ><td >447: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                        (cadr init)</pre></td></tr><tr ><td >448: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                        sdefault)))</pre></td></tr><tr ><td >449: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >          (loop (cdr specs)</pre></td></tr><tr ><td >450: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                (cons (list sname sval)</pre></td></tr><tr ><td >451: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >                      slots))))))</pre></td></tr><tr ><td >452: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" ></pre></td></tr><tr ><td >453: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >(define (%schema x)</pre></td></tr><tr ><td >454: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >  (if (%schema-instance? x)</pre></td></tr><tr ><td >455: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (%schema-instance-schema x)</pre></td></tr><tr ><td >456: </td><td align="center" ></td><td ><pre style="background-color:#ffffff" >      (%nothing)))</pre></td></tr></table></body></html>