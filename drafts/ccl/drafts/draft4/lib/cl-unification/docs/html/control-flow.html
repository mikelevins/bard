<html>
 <head>
     <title>CL Control Flow</title>
     <link rel="stylesheet" href="main.css">
 </head>
	
 <body marginheight="0" marginwidth="0" leftmargin="0" topmargin="0" bgcolor="#ffffff">

 <table border="0" cellpadding="0" cellspacing="0" width="100%" height="100%" vspace="0" hspace="0">
  <tr>
  <td colspan="3">
   <div class="header"
        style="font-family:=Verdana,Arial,Helvetica; font-size: 18px; color: #41286f;">
    <strong><i>CL Extensions: CONTROL FLOW</i><string>
    <div class="navigation">
     <a href="index.html" class="navigation-link-selected">Home</a>
      | <a href="downloads.html" class="navigation-link">Downloads</a>
      |  <a href="links.html" class="navigation-link">Links</a>
    </div>
   </div>
   <div class="black-line"><img src="images/shim.gif" height="1" width="1"></div>
   <div class="middle-bar"><img src="images/shim.gif" height="5" width="1"></div>
   <div class="black-line"><img src="images/shim.gif" height="1" width="1"></div>
  </td>
 </tr>

 <tr height="100%">
  <td height="100%">&nbsp;</td>
  <td valign="top" width="80%" height="100%">

  <div class="content">
  <div class="text" style="padding-top: 10px;">

  <h1>Control Flow</h1>

  <p>In order to make the use of the UNIFICATION library easier, a few
  utility macros are provided.  The macros MATCH, MATCHING, and
  MATCH-CASE can be used to unify two (or more) objects and then to
  build a lexical environment where the variables present in the to
  objects (or templates) are bound to the values resulting from the
  application of UNIFY.</p>

  <p>
  <ul>
  <li>MATCH is a "single shot" macro.  It does one unification and
  executes forms in an appropriate lexical environment.</li>

  <li>MATCH-CASE is equivalent to CASE.  It tries to match a single
  object (or template) against a set of clauses.  The forms associated
  to the first clause for which there is a successful unification, are
  then executed within an appropriate lexical environment.

  <li>MATCHING is equivalent to COND.  Each clause contains a
  <em>head</em consisting of two objects to be unified.  The first
  clause whose head unifies sucessfully has its associated forms
  executed within an appropriate lexical environment.
  </ul>
  </p>


  <h1>Examples</h1>

  <p>These macros allow the construction of interesting <em>pattern
  matching</em> like code.</p>

  <p>
  <pre>
  (defun factorial (x)
    (<b>match-case</b> (x)
      (0 1)
      (#T(number ?n) (* ?n (factorial (1- ?n))))
      (otherwise (error "Incorrect match for ~S." x))))
  </pre>
  </p>

  <p>Or consider the more interesting piece of code from a not-so
  hypothetical Red-Black tree implementation (<em>cfr.</em>&nbsp;[<a
  href="#O98">O98</a>].)  The function BALANCE is the key part of the
  rebalancing act played by Red-Black trees.</p>

  <p>
  <pre>
  (defstruct (tree-node (:conc-name tn-)
                        (:constructor mk-tn (color left elem right)))
     color
     left
     elem
     right)

  (defun balance (&rest balancing-arguments)
    (<b>match-case</b> (balancing-arguments)
      ((:black #T(tree-node tn-color :red
                            tn-left #T(tree-node tn-color :red
                                                 tn-left ?a
                                                 tn-elem ?x
                                                 tn-right ?b)
                            tn-elem ?y
                            tn-right ?c)
               ?z
               ?d)
        (mk-tn :red (mk-tn :black ?a ?x ?b) ?y (mk-tn :black ?c ?z ?d)))
      ((:black #T(tree-node tn-color :red
                            tn-left ?a
                            tn-elem ?x
                            tn-right #T(tree-node tn-color :red
                                                  tn-left ?b
                                                  tn-elem ?y
                                                  tn-right ?c))
               ?z
               ?d)
        (mk-tn :red (mk-tn :black ?a ?x ?b) ?y (mk-tn :black ?c ?z ?d)))
      ((:black ?a
               ?x
               #T(tree-node tn-color :red
                            tn-left #T(tree-node tn-color :red
                                                 tn-left ?b
                                                 tn-elem ?y
                                                 tn-right ?c)
                            tn-elem ?z
                            tn-right ?d))
        (mk-tn :red (mk-tn :black ?a ?x ?b) ?y (mk-tn :black ?c ?z ?d)))
      ((:black ?a
               ?x
               #T(tree-node tn-color :red
                            tn-left ?b
                            tn-elem ?y
                            tn-left #T(tree-node tn-color :red
                                                 tn-left ?c
                                                 tn-elem ?z
                                                 tn-right ?d)))
        (mk-tn :red (mk-tn :black ?a ?x ?b) ?y (mk-tn :black ?c ?z ?d)))
      ((?color ?left ?elem ?right)
        (mk-tn ?color ?left ?elem ?right))))
  </pre>
  </p>

  <p>This version of BALANCE is more verbose than the one given in [<a
  href="#O98">O98</a>], but it preserves the general elegance of the
  ML implementation.</p>



  <h1>Control Flow Dictionary</h1>

  <ul>
  <li><a href="match-macro.html"><i>Macro</i> <b>MATCH</b></a>
  <li><a href="matching-macro.html"><i>Macro</i> <b>MATCHING</b></a>
  <li><a href="match-case-macro.html"><i>Macro</i> <b>MATCH-CASE</b></a>
  </ul>
  


  <h1>Notes</h1>

  <h2>Other Forms</h2>

  <p>It would be obvious to add the macros EMATCH-CASE and
  CMATCH-CASE, for symmetry with ECASE and CCASE.   Also, MATCHING
  could be renamed to MATCH-COND.</p>


  <h2>Current Implementation Details</h2>

  <p>The current implementations of MATCHING and MATCH-CASE do not
  handle user supplied environments yet.</p>


  <h2>References</h2>

  <p>
  <a name="O98">[O98]</a> C. Okasaki, <i>Purely Functional Data
  Structures</i>, Cambridge University Press, 1998.


<!--
;;; Copyright (c) 2004 Marco Antoniotti, All rigths reserved.
;;;
;;; Permission to use, modify, and redistribute this code is hereby
;;; granted.
;;; The code is provided AS IS with NO warranty whatsoever. The author
;;; will not be held liable etc etc etc etc etc.
-->

  <h2>Site Map</h2>


  <p>Enjoy!</p>



  <hr>
  <p>Questions? Queries? Suggestions? Comments? Please direct them
  at <a href="mailto:marcoxa_PROVA_A_SPAMMARME@alu.org">me</a>.
  </p>

  </div>
  </div>
						
 </td>
 
 <!--  <td height="100%">&nbsp;</td> -->
 </tr>

 <tr height="100%">
  <td height="100%">&nbsp;</td>
  <td valign="top" width="80%" height="100%">

  <div class="content">
  <div class="text" style="padding-top: 10px;">

  <h1>News</h1>

  <p>News in chronological order, most recent on top.
  </p>

  <ul>
  <li><strong>2004-10-30</strong><br>
      Document created
  </li>
  </ul>

  </div>
  </div>
						
 </td>
 
 <td height="100%">&nbsp;</td>
 </tr>



 
 <tr>
  <td colspan="3" valign="bottom" align="right">
  <div class="copyright">
  &copy; 2003-2004, Marco Antoniotti, all rights reserved.
  </div>
  </td>
 </tr>
 
 </table>
 </body>
</html>
